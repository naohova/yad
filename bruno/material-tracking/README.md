# Material Tracking API Collection

Эта коллекция содержит запросы для тестирования API системы отслеживания материалов.

## Использование в Bruno Desktop Client

1. Установите [Bruno Desktop Client](https://www.usebruno.com/downloads)
2. Откройте Bruno Desktop Client
3. Выберите "Open Collection"
4. Укажите путь к папке `material-tracking`
5. Выберите окружение "Demo" для работы с тестовыми данными

## Структура коллекции

### Route Points
- **Create Route Point** (`route-points/create.bru`): Создание новой точки маршрута
  - Метод: POST
  - Путь: `/api/route-points`
  - Тело запроса: `name` и `type`

### Routes
- **Plan Material Route** (`routes/plan-route.bru`): Планирование маршрута для материала
  - Метод: POST
  - Путь: `/api/routes`
  - Тело запроса: `material_id` и массив `route_points`

- **Get Material Route** (`routes/get-material-route.bru`): Получение маршрута материала
  - Метод: GET
  - Путь: `/api/routes/material/{id}`

### Movements
- **Scan Material** (`movements/scan-material.bru`): Сканирование материала в точке маршрута
  - Метод: POST
  - Путь: `/api/movements/scan`
  - Тело запроса: `material_id`, `route_point_id`, `scanned_by` и `note`

## Тестовые данные

В коллекции настроены два окружения:
- **Local**: для локальной разработки
- **Demo**: для демонстрации с тестовыми данными

### Доступные тестовые данные:

#### Материалы:
- Корпус А-101 (ID: 1)
- Плата электронная B-201 (ID: 2)
- Блок питания C-301 (ID: 3)
- Готовое изделие X-1 (ID: 4)

#### Точки маршрута:
- Склад сырья (ID: 1)
- Участок подготовки (ID: 2)
- Линия сборки А1 (ID: 3)
- Линия сборки А2 (ID: 4)
- Контроль качества (ID: 5)
- Склад готовой продукции (ID: 6)

#### Пользователи:
- Иван Петров - оператор (ID: 1)
- Анна Сидорова - супервизор (ID: 2)
- Павел Николаев - оператор (ID: 3)

## Сценарии использования

1. **Создание нового маршрута**:
   - Создайте точку маршрута через `Create Route Point`
   - Спланируйте маршрут через `Plan Material Route`
   - Проверьте созданный маршрут через `Get Material Route`

2. **Отслеживание перемещения**:
   - Получите текущий маршрут через `Get Material Route`
   - Отсканируйте материал в точке через `Scan Material`
   - Проверьте обновленный статус через `Get Material Route`

## Настройка окружения

1. Загрузите тестовые данные в базу:
```bash
psql -U your_user -d your_database -f ../../tests/Fixtures/demo_data.sql
```

2. Убедитесь, что API сервер запущен и доступен по адресу из `environments/local.env.json`

## Переменные окружения

Файл `environments/local.env.json` содержит следующие переменные:
- `base_url`: Базовый URL API (по умолчанию: "http://localhost:8080")
- `api_prefix`: Префикс API (по умолчанию: "/api")

## Запуск тестов

1. Установите Bruno CLI
2. Перейдите в директорию коллекции
3. Запустите тесты командой:
   ```bash
   bruno run ./
   ```

## Последовательность выполнения

1. Создайте точки маршрута
2. Спланируйте маршрут для материала
3. Проверьте созданный маршрут
4. Отсканируйте материал в точках маршрута 